2024 / 11 / 4 
script4_2.js


【機能】

トーラスの曲面と（標準の）グリッドを表すチューブの表示する
ヴィラソートーラスの帯の表示、帯が交差する位置に球を表示する
1つ目のスライダーで形状を変化させる
1つ目のスライダーのつまみが中央より右か左かで帯の押し出しの方向を切り替える
2つ目のスライダーで曲面の透明度を変化させる
チェックボックスで無限遠点にとぶ点付近のメッシュを表示するか否かを切り替える


【script4_2.jsの大まかな流れ】

1.要素の生成（スライダー、キャンバス、チェックボックス）

2.オブジェクトの色を表す変数の宣言

3.オブジェクトの形状に関する変数の宣言（チューブの太さ、分割数など）

4.レンダラー・カメラ・シーン・ライトの生成・設定

5.オブジェクトに関する変数・関数の用意
・ヴィラソートーラスの関数　[u,v,t]=>[x,y,z]　曲面・球・帯のgraphic complex生成に使用
・トーラスの関数　[u,v,t]=>[x,y,z]　チューブのgraphic complex生成に使用
・曲面、チューブ、球、帯のgraphic complex、オブジェクトを格納するグローバル変数の宣言
・parameter1（オブジェクトの形状を変化させるグローバル変数）の宣言
・スライダー1を操作したときの処理（パラメータを更新 -> graphic complexを更新 -> オブジェクトを更新）
・スライダー2を操作したときの処理（曲面のマテリアルの更新）
・チェックボックスを操作したときの処理（graphic complexを更新 -> オブジェクトを更新）
・calculate_torus_gcC関数（graphic complexを更新する。第1引数：形状を変化させるパラメータ, 第2引数：切り抜くか否か）の定義
　※parameter1はグローバル変数なので引数なしの関数にもできますが、どの変数を使用しているか分かるようあえて引数付きの関数にしました
・update_torus_objectC関数（オブジェクトを更新する）の定義

6.オブジェクトの生成・追加
・calculate_torus_gcCを呼び出す
・graphic complexを使用してオブジェクトから生成する
・オブジェクトをシーンに追加
・レンダリング開始


【js特有の関数】

map関数：配列の各要素に対して関数を実行して配列を返す
（例）
[1,2,3,4,5].map( i => 3*i);  //[3,6,9,12,15]が出力される
※iは他の名称でもよい

forEach関数：配列の各要素に対して関数を実行する（返り値なし）
（例1）
let sum = 0;
[10,20,30,40,50].forEach( i => sum+=i ); //sumに各要素を追加する。sumの値が150になる。
（例2）
[10,20,30,40,50].forEach( (i,j) => console.log([i,j]); );    
// (i,j)=> と記述した場合、iは各要素の値、jは各要素の番地を表す。console.log([i,j])は[i,j]をコンソールに出力する。
//[10,0], [20,1], [30,2], [40,3], [50,4]の順にコンソールに出力される


【common_cgweb2_b.jsで定義した自作関数】

arrayC関数　
　オブジェクト{start:a1, end:a2, step:a3}から、a1からa2までa3刻みに動かした配列を生成する
　stepを省略した場合a3は1となる

createMeshC関数
　第1引数にgraphic complex, 第2引数にオプションを入れる。オブジェクトが出力される。
　graphic complexは頂点リストとポリゴンインデックスリストを並べた配列である

update_gcC関数
　オブジェクトのgraphic complexを更新する
　第1引数にオブジェクト、第2引数にgraphic complexを入れる

update_materialC関数
　オブジェクトのマテリアルを更新する
　第1引数にオブジェクト、第2引数にオプションを入れる
　（例） update_materialC(object1, {color:0xff0000, opacity:0.5, visible:true, flatshade:true, side:"front"});
　※全てのオプションを設定する必要はない

spherecutC関数
　第1引数にgraphic complex, 第2引数に半径rを入れる。半径rの球面カットしたgraphic complexが返される

sphere_gcC関数
　第1引数に長さ3の配列[x,y,z], 第2引数に半径rを入れる。中心[x,y,z],半径rのICO球（頂点数42）のgraphic complexを返す。

tube_gcC関数
　第1引数にポイントリスト[[x1,y1,z1],[x2,y2,z2],...], 第2引数にチューブ半径、第3引数にチューブの断面の多角形の角数を入れる。
　チューブのgraphic complexが返される。

parametric_index2C関数
　[x,y,z] = f(u,v)　で表される曲面のポリゴンインデックスリストを返す
　第1引数：uの配列 [u1,u2,u3,...un], 第2引数：vの配列 [v1,v2,v3,...vm], 
　第3引数：u,vの範囲を制限する関数（省略可） 
　　　　　（例） (u,v)=>{if(u>=PI*3/8 || v>=PI*3/8) return true;}

ribbon_gcC関数
　2変数関数が表す曲面上の帯のgraphic complexを生成する
　第1引数：関数, 第2引数：関数に入力するポイントリスト, 第3引数：帯の幅, 第4引数：帯を法線方向に押し出す量